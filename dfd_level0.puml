' dfd_level0.puml

'------------------------------------------------------
' DFD Level 0 Library: Procedures for Processes, Data Stores,
' External Entities, Subgraphs, and Data Flows (using Graphviz DOT syntax)
'------------------------------------------------------

' Define startDfd and endDfd procedures
!procedure startDfd()
digraph dfd2 {
    node[shape=record]
!endprocedure

!procedure endDfd()
}
!endprocedure

' Title procedure: sets graph attributes with an HTML-like label
!procedure Title($title)
    graph [rankdir=LR, ranksep=1.5, splines=true, overlap=false, labeljust=c, labelloc=t, \
    label=<<TABLE BORDER="0" CELLBORDER="0">
    <TR><TD><FONT POINT-SIZE="16">$title</FONT></TD></TR>
    <TR><TD><FONT POINT-SIZE="10">DFD Level 0 Diagram</FONT></TD></TR>
    </TABLE>>];
!endprocedure

' Process procedure with step number
' Usage: Process(alias, stepID, name)
!procedure Process($alias, $id, $name)
    $alias [label="{<f0> $id|<f1> $name\n\n\n}", shape=Mrecord, pos="0,0!", fontcolor=black, fontsize=12, color=black, penwidth=2];
!endprocedure

' Store procedure for data stores
' Usage: Store(alias, stepID, name)
!procedure Store($alias, $id, $name)
    $alias [label="<f0> $id   |<f1> $name", fontcolor=black, fontsize=12, color=black, penwidth=2];
!endprocedure

' External procedure for external entities
!procedure External($alias, $label)
    $alias [label="$label", shape=box, fontcolor=black, fontsize=12, color=black, penwidth=2];
!endprocedure

' Data Flow macros
!procedure InFlow($alias1, $alias2, $label="")
    !if ($label != "")
        $alias1 -> $alias2 [label="$label", fontcolor=black, fontsize=10, color=black, penwidth=1];
    !else
        $alias1 -> $alias2 [color=black, penwidth=1];
    !endif
!endprocedure

!procedure OutFlow($alias1, $alias2, $label="")
    !if ($label != "")
        $alias2 -> $alias1 [label="$label", dir=back, fontcolor=black, fontsize=10, color=black, penwidth=1];
    !else
        $alias2 -> $alias1 [dir=back, fontcolor=black, fontsize=10, color=black, penwidth=1];
    !endif
!endprocedure

!procedure BiFlow($alias1, $alias2, $label="")
    !if ($label != "")
        $alias1 -> $alias2 [label="$label", dir=both, fontcolor=black, fontsize=10, color=black, penwidth=1];
    !else
        $alias1 -> $alias2 [dir=both, fontcolor=black, fontsize=10, color=black, penwidth=1];
    !endif
!endprocedure

'------------------------------------------------------
' Procedures for subgraph blocks
'------------------------------------------------------
' Start a subgraph with a given name and label
!procedure StartSubgraph($name, $label)
subgraph $name {
    label = "$label";
!endprocedure

' End a subgraph block
!procedure EndSubgraph()
}
!endprocedure

' Procedure to group nodes in the same rank
!procedure SameRank($aliases)
{rank=same; $aliases}
!endprocedure
